{include file="head" /}
{include file="menu" /}

<section id="main-content">
  <section class="wrapper">
    <div class="row">
      <div class="col-lg-8">
        <section class="panel">
          <header class="panel-heading">Sửa dự án #{$project.id}</header>
          <div class="panel-body">
<form id="projectEditForm"
      method="post"
      enctype="multipart/form-data"
      action="{:url('lord/project/projectedit',['id'=>$project.id])}">
  <div class="form-group">
    <label>Tiêu đề</label>
    <input type="text" class="form-control" name="title" value="{$project.title|htmlentities}" required>
  </div>

  <div class="form-group">
    <label>Mô tả</label>
    <textarea class="form-control" rows="4" name="description">{$project.description|default=''}</textarea>
  </div>

  <div class="form-group">
    <label>Ảnh dự án</label>
    <input type="file" class="form-control" name="image" accept=".jpg,.jpeg,.png,.webp">
    {if !empty($project.image)}
      <div style="margin-top:8px">
        <img src="{$project.image}" alt="Project image" style="max-width:200px; height:auto; border:1px solid #eee;">
      </div>
    {/if}
  </div>

  <div class="form-group">
    <label>Lãi/ngày (%)</label>
    <input type="number" step="0.001" class="form-control" name="rate_daily" value="{$project.rate_daily}" required>
  </div>

  <div class="form-group">
    <label>Kỳ hạn (ngày)</label>
    <input type="number" class="form-control" name="duration_days" value="{$project.duration_days}" required>
  </div>

  <div class="form-group">
    <label>Tối thiểu đầu tư</label>
    <input type="number" step="0.01" class="form-control" name="min_invest" value="{$project.min_invest}">
  </div>

  <div class="form-group">
    <label>Hạn mức</label>
    <input type="number" step="0.01" class="form-control" name="total_quota" value="{$project.total_quota}">
  </div>

  <div class="form-group">
    <label>Trạng thái</label>
    <select name="status" class="form-control">
      <option value="1" {if $project.status==1}selected{/if}>Mở</option>
      <option value="0" {if $project.status==0}selected{/if}>Ẩn</option>
      <option value="2" {if $project.status==2}selected{/if}>Kết thúc</option>
    </select>
  </div>

  <button type="submit" class="btn btn-success">Lưu</button>
  <a href="{:url('project/projectlist')}" class="btn btn-default">Quay lại</a>
</form>

          </div>
        </section>
      </div>
    </div>
  </section>
</section>

{include file="foot" /}
<script>
$('#projectEditForm').on('submit', function(e){
  e.preventDefault();
  var $f = $(this);
  var formData = new FormData($f[0]);
  $.ajax({
    url: $f.attr('action'),
    type: 'POST',
    data: formData,
    processData: false, // quan trọng
    contentType: false, // quan trọng
    success: function(res){
      layer.msg(res.data);
      if(res.type == 1 && res.redirect){
        location.href = res.redirect;
      }
    },
    error: function(){
      layer.msg('Lỗi mạng, vui lòng thử lại');
    }
  });
});
</script>
