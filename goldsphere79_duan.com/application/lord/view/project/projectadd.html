{include file="head" /}
{include file="menu" /}

<section id="main-content">
  <section class="wrapper">
    <div class="row">
      <div class="col-lg-8">
        <section class="panel">
          <header class="panel-heading">Tạo dự án</header>
          <div class="panel-body">
            <form id="projectAddForm"
                  method="post"
                  enctype="multipart/form-data" 
                  action="{:url('lord/project/projectadd')}">

              <div class="form-group">
                <label>Tiêu đề</label>
                <input type="text" class="form-control" name="title" required>
              </div>

              <div class="form-group">
                <label>Mô tả</label>
                <textarea class="form-control" rows="4" name="description"></textarea>
              </div>

              <!-- THÊM TRƯỜNG ẢNH -->
              <div class="form-group">
                <label>Ảnh dự án</label>
                <input type="file" class="form-control" name="image" accept=".jpg,.jpeg,.png,.webp">
                <!-- (tuỳ chọn) preview nhanh trên client -->
                <img id="preview" style="display:none;margin-top:8px;max-width:200px;height:auto;border:1px solid #eee;">
              </div>

              <div class="form-group">
                <label>Lãi/ngày (%)</label>
                <input type="number" step="0.001" class="form-control" name="rate_daily" value="0.5" required>
              </div>

              <div class="form-group">
                <label>Kỳ hạn (ngày)</label>
                <input type="number" class="form-control" name="duration_days" value="30" required>
              </div>

              <div class="form-group">
                <label>Tối thiểu đầu tư</label>
                <input type="number" step="0.01" class="form-control" name="min_invest" value="100">
              </div>

              <div class="form-group">
                <label>Hạn mức (0 = không giới hạn)</label>
                <input type="number" step="0.01" class="form-control" name="total_quota" value="0">
              </div>

              <div class="form-group">
                <label>Trạng thái</label>
                <select name="status" class="form-control">
                  <option value="1">Mở</option>
                  <option value="0">Ẩn</option>
                </select>
              </div>

              <button type="submit" class="btn btn-success">Tạo dự án</button>
              <a href="{:url('project/projectlist')}" class="btn btn-default">Quay lại</a>
            </form>
          </div>
        </section>
      </div>
    </div>
  </section>
</section>

{include file="foot" /}
<script>
// (tuỳ chọn) preview ảnh
$('[name="image"]').on('change', function(){
  const f = this.files && this.files[0];
  if (!f) return $('#preview').hide();
  const url = URL.createObjectURL(f);
  $('#preview').attr('src', url).show();
});

// Submit bằng FormData để gửi file
$('#projectAddForm').on('submit', function(e){
  e.preventDefault();
  var $f = $(this);
  var formData = new FormData($f[0]);
  $.ajax({
    url: $f.attr('action'),
    type: 'POST',
    data: formData,
    processData: false,   // quan trọng
    contentType: false,   // quan trọng
    success: function(res){
      layer.msg(res.data);
      if(res.type == 1 && res.redirect){ location.href = res.redirect; }
    },
    error: function(){
      layer.msg('Lỗi mạng, vui lòng thử lại');
    }
  });
});
</script>
